<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Customers - Superkicks</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

</head>

<body class="bg-gray-100 font-sans">

  <div class="flex min-h-screen">
    <!-- Sidebar -->
    <aside class="w-64 bg-[#15172B] text-white flex flex-col justify-between">
      <div>
        <h2 class="text-center text-2xl font-bold py-6">SUPERKICKS</h2>
        <ul class="space-y-2 px-4">
          <li><a href="/admin/dashboard" class="flex items-center p-2 hover:bg-blue-600 rounded"><i
                class="fas fa-tachometer-alt mr-2"></i> Dashboard</a></li>
          <li><a href="/admin/customers" class="flex items-center p-2 bg-blue-600 rounded"><i
                class="fas fa-users mr-2"></i> Customers</a></li>
          <li><a href="/admin/products" class="flex items-center p-2 hover:bg-blue-600 rounded"><i
                class="fas fa-box mr-2"></i> Products</a></li>
          <li><a href="/admin/orders" class="flex items-center p-2 hover:bg-blue-600 rounded"><i
                class="fas fa-shopping-cart mr-2"></i> Orders</a></li>
          <li><a href="/admin/coupons" class="flex items-center p-2 hover:bg-blue-600 rounded"><i
                class="fas fa-tags mr-2"></i> Coupon Management</a></li>
          <li><a href="/admin/sales-report" class="flex items-center p-2 hover:bg-blue-600 rounded"><i
                class="fas fa-chart-line mr-2"></i> Sales Report</a></li>
          <li><a href="/admin/category" class="flex items-center p-2 hover:bg-blue-600 rounded"><i
                class="fas fa-layer-group mr-2"></i> Category</a></li>
        </ul>
      </div>
      <div class="px-4 py-4 space-y-2">
        <a href="/admin/settings" class="flex items-center p-2 hover:bg-blue-600 rounded"><i
            class="fas fa-cog mr-2"></i> Settings</a>
        <a href="/admin/logout" class="flex items-center p-2 hover:bg-red-600 rounded"><i
            class="fas fa-sign-out-alt mr-2"></i> Logout</a>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 p-6">
      <header class="flex justify-end mb-4">
        <div class="flex items-center gap-2 text-gray-700">
          <i class="fas fa-user"></i>
          <span class="font-semibold">ADMIN</span>
        </div>
      </header>

      <h2 class="text-2xl font-semibold text-gray-800 mb-4">Customers</h2>

      <div class="flex justify-between items-center mb-4">
        <div class="flex gap-2 items-center">
          <label class="text-gray-600">Sort:
            <select class="ml-2 border px-2 py-1 rounded">
              <option>Name</option>
              <option>Email</option>
            </select>
            <select class="ml-2 border px-2 py-1 rounded">
              <option>Ascending</option>
              <option>Descending</option>
            </select>
          </label>
        </div>

        <form action="/admin/customers" method="GET" class="flex items-center">
          <input   type="text"     name="q"     value="<%= typeof query !== 'undefined' ? query : '' %>"    
            placeholder="Search by name or email..."     class="ml-2 border px-2 py-1 rounded"   />
            <% if (typeof query !=='undefined' && query) { %>
                <a href="/admin/customers" class="ml-2 px-2 py-1 bg-gray-300 rounded hover:bg-gray-400">Clear</a>
              <% } %>
                <button type="submit" class="ml-2 px-2 py-1 bg-blue-600 text-white rounded">Search</button>
        </form>

      </div>

      <div class="overflow-x-auto rounded-lg">
        <table class="w-full text-sm text-left bg-white shadow-lg rounded-lg">
          <thead class="bg-gray-200 text-gray-700">
            <tr>
              <th class="px-4 py-3">S.No</th>
              <th class="px-4 py-3">Name</th>
              <th class="px-4 py-3">Email</th>
              <th class="px-4 py-3">Mobile</th>
              <th class="px-4 py-3">Status</th>
              <th class="px-4 py-3">Update</th>
            </tr>
          </thead>
          <tbody class="text-gray-700">
            <% customers.forEach((user, index)=> { %>
              <tr class="border-t">
                <td class="px-4 py-2">
                  <%= index + 1 %>
                </td>
                <td class="px-4 py-2">
                  <%= user.fullName %>
                </td>
                <td class="px-4 py-2">
                  <%= user.email %>
                </td>
                <td class="px-4 py-2">
                  <%= user.phone %>
                </td>
                <td class="px-4 py-2 text-center">
                  <% if (user.isBlocked) { %>
                    <span class="text-red-600 font-semibold">Blocked</span>
                    <% } else { %>
                      <span class="text-green-600 font-semibold">Active</span>
                      <% } %>
                </td>
                <td class="px-4 py-2 text-center">
                  <form action="/admin/customers/<%= user._id %>/toggle" method="POST">
                    <label class="inline-flex items-center cursor-pointer">
                      <input type="checkbox" name="status" class="sr-only peer" <%=user.isBlocked ? '' : 'checked' %>
                      onclick="return confirmToggleUser(this, '<%= user.fullName %>')"
                        />
                        <div
                          class="w-11 h-6 bg-gray-300 rounded-full peer peer-checked:bg-green-500 relative transition-colors">
                          <div
                            class="absolute left-1 top-1 w-4 h-4 bg-white rounded-full shadow-md transition-transform peer-checked:translate-x-5">
                          </div>
                        </div>
                    </label>
                  </form>

                </td>
              </tr>
              <% }) %>
          </tbody>
        </table>
      </div>

      <div class="mt-4 flex justify-between items-center text-sm text-gray-600">
        <div>
          Page <%= currentPage %> of <%= totalPages %>
        </div>
        <div class="space-x-2">
          <% if (currentPage> 1) { %>
            <a href="/admin/customers?<%= query ? 'q=' + encodeURIComponent(query) + '&' : '' %>page=<%= currentPage - 1 %>"
              class="px-3 py-1 rounded bg-gray-200 hover:bg-gray-300">Previous</a>
            <% } %>
              <% if (currentPage < totalPages) { %>
                <a href="/admin/customers?<%= query ? 'q=' + encodeURIComponent(query) + '&' : '' %>page=<%= currentPage + 1 %>"
                  class="px-3 py-1 rounded bg-gray-200 hover:bg-gray-300">Next</a>
                <% } %>
        </div>
      </div>

    </main>
  </div>
  <script>
    function confirmToggleUser(checkbox, fullName) {
      console.log(checkbox)
      const willBeBlocked = !checkbox.checked;
      const actionText = willBeBlocked ? "block" : "unblock";
      // Prevent UI toggle before confirmation
      checkbox.checked = !checkbox.checked;

      Swal.fire({
        title: 'Are you sure?',
        text: `Do you want to ${actionText} user "${fullName}"?`,
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: `Yes, ${actionText}`,
        reverseButtons: true
      }).then((result) => {
        if (result.isConfirmed) {
          checkbox.checked = !checkbox.checked;
          console.log(checkbox.form)
          checkbox.form.submit();
        }
        
      });

      return false; 
    }
  </script>


</body>

</html>